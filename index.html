<!DOCTYPE HTML>
<html>
	<head>
		<title>LNM Calculator</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- CSS Links -->
		<link rel="stylesheet" type="text/css" href="css/mobiscroll.css">
		<link rel="stylesheet" type="text/css" href="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.css">
		
		<!-- Custom CSS -->
		<style type="text/css">
			.ui-page { -webkit-backface-visibility: hidden; background: #CCCCCC; }
			
		</style>
		<!-- Scripts -->
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
		<script type="text/javascript">
			$(document).bind("mobileinit", function(){
				$.mobile.defaultPageTransition="none";
				$.mobile.page.prototype.options.degradeInputs.date = true;
			});
		</script>
		<script type="text/javascript" src="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.js"></script>
		<script type="text/javascript" src="js/mobiscrollcore.js"></script>
		<script type="text/javascript" src="js/mobiscroll.js"></script>
		
		<!-- Bootstrap code -->
		<script type="text/javascript">
			$(document).ready(function(){
				// Place code here
				
			});
		</script>
	</head>
	<body>
		<!-- Main Page -->
		<div data-role="page" id="main" data-transition="none">
			<div data-role="header" data-theme="b" data-position="fixed">
				<h1>LNM Calculator</h1>
			</div>
			<div data-role="content" data-theme="b">
				<div style=" text-align:center">
                    <img style="width: 100px; height: 100px" src="images/pregicon.png">
                </div>
                <p></p>
                <fieldset data-role="controlgroup">
					<ul data-role="listview" data-theme="g">
						<li>
							<a href="#lnm" data-transition="none" >Last Normal Menstruation</a>
						</li>
						<li>
							<a href="#weeksanddays"  data-transition="none">Weeks and days</a>
						</li>
						<li>
							<a href="#edd"  data-transition="none">Expected date of Delivery</a>
						</li>
						<li>
							<a href="#pastdateweeksanddays"  data-transition="none">Past Date, weeks and days</a>
						</li>
					</ul>
				</fieldset>
				<p></p>
				<div data-role="collapsible-set" data-theme="b" data-content-theme="a">
                    <div data-role="collapsible" data-collapsed="true">
                        <h3>
                            How to use this app
                        </h3>
                        <div>
                            <p>
                                Select from the selection bar above the appropriate date selection.
                            </p>
                            <p><u>LNM - Last Normal Mentruation</u></br></br>Submit the last normal mentruation date that is know for the 
                                pregnancy.
                            </p>
                            <p><u>Weeks and Days</u></br></br>Submit the weeks and days of the current pregnancy.
                            </p>
                            <p><u>EDD - Expected Date of Delivery</u></br></br>Submit the expected date of delivery that is known for the
                                pregnancy.
                            </p>
                            <p><u>Past Date</u></br></br>Submit a past date with its associate weeks/days for the pregnancy.
                            </p>

                        </div>
                    </div>
                    <div data-role="collapsible" data-collapsed="true">
                        <h3>
                            Disclaimer
                        </h3>
                        <div>
                            <p>
                                This application is not a substitute for medical advice. Any and all liability
                                arising directly or indirectly from the use of this application is hereby
                                disclaimed. The information herein is provided "as is" and without any
                                warranty expressed or implied. All direct, indirect, special, incidental,
                                consequential or punitive damages arising from any use of this application
                                or data contained herein is disclaimed and excluded.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
			<div data-role="footer" data-theme="b" data-position="fixed">
				<p></p>
			</div>
		</div>
		<script type="text/javascript">
                $("#main").on("pageshow", onPageShow);

                function onPageShow(e,data)
                {
                	clearValues();
                    $("#main").css("display", "none");
					$("#main").fadeIn(1500);
                }
        </script>
		<!-- LNM Page -->
		<div  data-role="page" data-add-back-btn="true" id="lnm">
			<div data-role="header" data-theme="b" data-position="fixed">
				<h1>LNM Calculator</h1>
			</div>
			<div data-role="content" data-theme="b">
				<fieldset data-role="controlgroup">
					<label for="date">Last Normal Menstuation:</label>
					<input type="date" name="date" id="lnmdate" value=""  />
				</fieldset>
				<a href="#result" data-role="button" data-transition="none">Calculate</a>
			</div>
			<div data-role="footer" data-theme="b" data-position="fixed">
				<p></p>
			</div>
		</div>
		<script type="text/javascript">
                $("#lnm").on("pageshow", onPageShow);

                function onPageShow(e,data)
                {
                	$("#lnmdate").scroller({ preset: 'date' });
                	clearValues();
                    $("#lnm").css("display", "none");
					$("#lnm").fadeIn(1500);
                }
        </script>
		<!-- Weeks and days Page -->
		<div data-role="page" data-add-back-btn="true" id="weeksanddays">
			<div data-role="header" data-theme="b" data-position="fixed">
				<h1>LNM Calculator</h1>
			</div>
			<div data-role="content" data-theme="b">
				<div data-role="fieldcontain">
                    <fieldset data-role="controlgroup">
                        <label for="weeks">
                            Weeks:
                        </label>
                        <input name="weeks" id="weeks" placeholder="" value="0" type="range" min="0" max="39">
                    </fieldset>
                </div>
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup" >
                        <label for="days">
                            Days:
                        </label>
                        <input name="days" id="days" placeholder="" value="0" type="range" min="0" max="6">
                    </fieldset>
                </div>
                <div>
                	<a href="pages/lnm.html" data-role="button" data-transition="none">Calculate</a>
                </div>
			</div>	
			<div data-role="footer" data-theme="b" data-position="fixed">
				<p></p>
			</div>
		</div>
		<script type="text/javascript">
                $("#weeksanddays").on("pageshow", onPageShow);

                function onPageShow(e,data)
                {
                	clearValues();
                    $("#weeksanddays").css("display", "none");
					$("#weeksanddays").fadeIn(1500);
                }
        </script>
		<!-- EDD page -->
		<div data-role="page" data-add-back-btn="true" id="edd">
			<div data-role="header" data-theme="b" data-position="fixed">
				<h1>LNM Calculator</h1>
			</div>
			<div data-role="content" data-theme="b">
				<fieldset data-role="controlgroup">
					<label for="date">Expected Date of Delivery:</label>
					<input type="date" name="date" id="edddate" value=""  />
				</fieldset>
				<a href="#result" data-role="button" data-transition="none">Calculate</a>
			</div>
			<div data-role="footer" data-theme="b" data-position="fixed">
				<p></p>
			</div>
		</div>
		<script type="text/javascript">
                $("#edd").on("pageshow", onPageShow);

                function onPageShow(e,data)
                {
                	$("#edddate").scroller({ preset: 'date' });
                	clearValues();
                    $("#edd").css("display", "none");
					$("#edd").fadeIn(1500);
                }
        </script>
		<!-- Past Date and Weeks and days Page -->
		<div data-role="page" data-add-back-btn="true" id="pastdateweeksanddays">
			<div data-role="header" data-theme="b" data-position="fixed">
				<h1>LNM Calculator</h1>
			</div>
			<div data-role="content" data-theme="b">
				<div data-role="fieldcontain">
					<fieldset data-role="controlgroup">
						<label for="pastdate">On this date:</label>
						<input type="date" name="date" id="pastdate" value=""  />
					</fieldset>
				</div>
				<div data-role="fieldcontain">
                    <fieldset data-role="controlgroup">
                        <label for="pastweeks">
                            she was weeks:
                        </label>
                        <input name="pastweeks" id="pastweeks" placeholder="" value="0" type="range" min="0" max="39">
                    </fieldset>
                </div>
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup" >
                        <label for="pastdays">
                            and days:
                        </label>
                        <input name="pastdays" id="pastdays" placeholder="" value="0" type="range" min="0" max="6">
                    </fieldset>
                </div>
                <div>
                	<a href="#result" data-role="button" data-transition="none">Calculate</a>
                </div>
             </div>
			<div data-role="footer" data-theme="b" data-position="fixed">
				<p></p>
			</div>
		</div>
		<script type="text/javascript">
                $("#pastdateweeksanddays").on("pageshow", onPageShow);

                function onPageShow(e,data)
                {
                	$("#pastdate").scroller({ preset: 'date' });
                	clearValues();
                    $("#pastdateweeksanddays").css("display", "none");
					$("#pastdateweeksanddays").fadeIn(1500);
                }
        </script>
		<!-- Result Page -->
		<div data-role="page" id="result" data-add-back-btn="true">
			<div data-role="header" data-theme="b" data-position="fixed">
				<h1>LNM Calculator</h1>
			</div>
			<div data-role="content" data-theme="b">
				<p id="displayresult">You are in result</p>
				<a href="#main" data-role="button" data-transition="none" data-icon="home">Home</a>
			</div>
			<div data-role="footer" data-theme="b" data-position="fixed">
				<p></p>
			</div>
		</div>
		<script type="text/javascript">
                $("#result").on("pageshow", onPageShow);

                function onPageShow(e,data)
                {
                	var lnm = $('#lnmdate').val();
                    var weeks = $('#weeks').val();
                    var days = $('#days').val();
                    var edd = $('#edddate').val();
                    var pastdate = $('#pastdate').val();
                    var pastweeks = $('#pastweeks').val();
                    var pastdays = $('#pastdays').val();
                    var result = ""
                    var now = new Date()

                    if(lnm != ""){
                        
                        var lnmDate = checkMonthDate(lnm);                       
                        var eddDate = new Date(lnmDate.getTime()+(86400000 * 280));
                        var timeDiff = Math.abs(now.getTime() - lnmDate.getTime());
                        var diffDays = Math.floor(timeDiff / (1000 * 3600 * 24));
                        var myweeks = Math.floor(diffDays / 7);
                        var mydays = diffDays % 7;
                        result = resultOutput(lnmDate, eddDate, myweeks, mydays);

                    }  else if (edd != ""){

                        var eddDate = checkMonthDate(edd);
                        var lnmDate = new Date(eddDate.getTime()-(86400000 * 280));
                        var timeDiff = Math.abs(now.getTime() - lnmDate.getTime());
                        var diffDays = Math.floor(timeDiff / (1000 * 3600 * 24));
                        var myweeks = Math.floor(diffDays / 7);
                        var mydays = diffDays % 7;
                        result = resultOutput(lnmDate, eddDate, myweeks, mydays);

                    } else if (pastdate != ""){
                        if (pastweeks == "0" && pastdays == "0"){
                            result += "Weeks and days can not be 0. Please enter new values."
                        } else if (pastweeks != "0" || pastdays != "0"){
                            var pastDate = checkMonthDate(pastdate);
                            var totalDays = (7 * parseInt(pastweeks, 10)) + parseInt(pastdays, 10);
                            var lnmDate = new Date(pastDate.getTime()-(1000 * 3600 * 24 * totalDays));
                            var eddDate = new Date(lnmDate.getTime()+(86400000 * 280));
                            result = resultOutput(lnmDate, eddDate, pastweeks, pastdays);
                        }
                      
                        
                    } else if (weeks != "0" || days != "0"){
                        var totalDays = (7 * parseInt(weeks, 10)) + parseInt(days, 10);
                        var futureDays = 180 - totalDays;
                        var lnmtoday = new Date();
                        lnmtoday.setDate(lnmtoday.getDate()-totalDays)
                        var lnmDate = new Date(lnmtoday);
                        var eddtoday = new Date();
                        eddtoday.setDate(eddtoday.getDate()+futureDays);
                        var eddDate = new Date(eddtoday);
                        result = resultOutput(lnmDate, eddDate, weeks, days);
                    }  else {
                        result += "You did not enter the values correctly. Please enter new values.";
                    }                      
                    $('#displayresult').html(result);
              
                    $("#result").css("display", "none");
					$("#result").fadeIn(1500);
                }
        </script>
        <script type="text/javascript">
        	// Clear values in pages
        	function clearValues(){
                $('#lnmdate').val("");
                $('#weeks').val(0);
                $('#days').val(0);
                $('#edddate').val("");
                $('#pastdate').val("");
                $('#pastweeks').val(0);
                $('#pastdays').val(0); 
                $('#displayresult').html("");
              }
            function resultOutput(templnm, tempedd, tempweeks, tempdays){
                    var result = "";

                    result += "Last Normal Mentruation:</br></br><b>" + templnm.toDateString() + "</b></br></br>";
                    result += "Expected Date of Delivery:</br></br><b>" + tempedd.toDateString() + "</b></br></br>";
                    result += "Currently <b>" + tempweeks + " weeks</b> and <b>" + tempdays + " days</b> pregnant.</br></br>";
                    return result;
              }
              // Check if calendar month date is 1 or 2 digits
            function checkMonthDate(checkDate){   
            	if (checkDate.substring(0,1) == "0"){
            		var month = parseInt(checkDate.substring(1,2));
            	} else {        
                    var month = parseInt(checkDate.substring(0,2));
                }
                var year = parseInt(checkDate.substring(6,10));
                var day = parseInt(checkDate.substring(3,5));
                month -= 1;
                var multiDate = new Date(year, month, day, 0, 0, 0, 0);
                return multiDate;
            }

        </script>
	</body>
</html>
